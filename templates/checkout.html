{% extends 'master/base.html' %}
{% load static %}
{% block title %}Cart {% endblock %}

{% block body %}

<!-- Breadcrumbs -->
		<div class="breadcrumbs">
			<div class="container">
				<div class="row">
					<div class="col-12">
						<div class="bread-inner">
							<ul class="bread-list">
								<li><a href="index1.html">Home<i class="ti-arrow-right"></i></a></li>
								<li class="active"><a href="blog-single.html">Checkout</a></li>
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- End Breadcrumbs -->
				
		<!-- Start Checkout -->
		<section class="shop checkout section">
			<div class="container">
				<div class="row"> 
					<div class="col-lg-8 col-12">
						<div class="row">
							<div class="col-12">
								<!-- Shopping Summery -->
								<table class="table shopping-summery">
									<thead>
										<tr class="main-hading">
											<th>PRODUCT</th>
											<th>NAME</th>
											<th class="text-center">UNIT PRICE</th>
											<th class="text-center">QUANTITY</th>
											<th class="text-center">TOTAL</th> 
											<th class="text-center"><i class="ti-trash remove-icon"></i></th>
										</tr>
									</thead>
									<tbody>
										{% for item in items %}
										<tr>
											<td class="image" data-title="No"><img src="{{item.product.imageURL}}" alt="#"></td>
											<td class="product-des" data-title="Description">
												<p class="product-name"><a href="#">{{item.product.product_name}}</a></p>
												<p class="product-des">{{item.product.product_details}}</p>
											</td>
											<td class="price" data-title="Price"><span>Nrs. {{item.product.product_price|floatformat:2}} </span></td>

											<td class="qty" data-title="Qty">

													<!-- Input Order -->
												<p>{{item.quantity}}</p>
													
											
												<img src="{% static 'images/arrow-up.png' %}" class="update-cart" data-product="{{item.product.id}}" data-action="add" 
													style="width: 15px;height:15px;cursor: pointer;display: block;">
												<img src="{% static 'images/arrow-up.png' %}" class="update-cart" data-product="{{item.product.id}}" data-action="remove"
													style="width: 15px;height:15px;cursor: pointer;display: block;-webkit-transform:rotate(180deg);">
											


											<!--<td class="qty" data-title="Qty">
												<div class="input-group">
													<div class="button minus">
														<button type="button" class="btn btn-primary btn-number" disabled="disabled" data-type="minus" data-field="quant[1]">
															<i class="ti-minus"></i>
														</button>
													</div>
													<input type="text" name="quant[1]" class="input-number"  data-min="1" data-max="100" value="{{item.quantity}}">
													<div class="button plus">
														<button type="button" class="btn btn-primary btn-number" data-type="plus" data-field="quant[1]">
															<i class="ti-plus"></i>
														</button>
													</div>
												</div>
												/ End Input Order -->

											</td>
											<td class="total-amount" data-title="Total"><span>Nrs {{item.get_total|floatformat:2}}</span></td>
											<td class="action" data-title="Remove"><a href="#"><i class="ti-trash remove-icon"></i></a></td>
										</tr>
										{% endfor %}
									</tbody>
								</table>
								<!--/ End Shopping Summery -->
							</div>
						</div>
					</div>

					<div class="col-lg-4 col-12 pl-5">
						<div class="order-details">
							<!-- Order Widget -->
							<div class="single-widget">
								<h2>CART  TOTALS</h2>
								<div class="content">
									<ul>
										<li>Sub Total<span>Nrs. {{order.get_cart_total|floatformat:2}}</span></li>

										<div id="delivery-charge">
											<li>(+) Delivaery<span>Nrs. 50</span></li>
										</div>

										

										<li class="last">Total<span>{{order.get_cart_grandtotal|floatformat:2}}</span></li>
									</ul>
								</div>
							</div>
							<!--/ End Order Widget -->
							<!-- Order Widget -->
							<div class="single-widget">
								<h2>Payments</h2>
								<div class="content">
									<div class="checkbox">
										<label class="checkbox-inline" for="1"><input name="updates" id="1" type="checkbox"> Check Payments</label>
										<label class="checkbox-inline" for="2"><input name="news" id="2" type="checkbox"> Cash On Delivery</label>
										<label class="checkbox-inline" for="3"><input name="news" id="3" type="checkbox"> PayPal</label>
									</div>
								</div>
							</div>
							<!--/ End Order Widget -->
							<!-- Payment Method Widget -->
							<div class="single-widget payement">
								<div class="content">
									<img src="{% static 'images/payment-method.png' %}" alt="#">
								</div>
							</div>
							<!--/ End Payment Method Widget -->
							<!-- Button Widget -->
							<div class="single-widget get-button" id="checkout">
								<div class="content">
									<div class="button">
										<input type="submit" id="form-buttons" href="#" class="btn">proceed to checkout</a>
									</div>
								</div>
							</div>

					</div>
			</div>


        <div class="rows">
          <div class="col-50">
			<h3>Billing Address</h3>
			
			<div id = 'user-info'>
				<label for="fname"><i class="fa fa-user"></i> Full Name</label>
				<input type="text" id="fname" name="firstname" placeholder="John M. Doe">
				<label for="email"><i class="fa fa-envelope"></i> Email</label>
				<input type="text" id="email" name="email" placeholder="john@example.com" required>
				<label for="adr"><i class="fa fa-address-card-o"></i> Address Line 1</label>
				<input type="text" id="adr" name="address" placeholder="542 W. 15th Street">
				<label for="adr"><i class="fa fa-address-card-o"></i> Address Line 2</label>
				<input type="text" id="adr" name="address1" placeholder="542 W. 15th Street">
				<label for="zip">Zip</label>
				<input type="text" id="zip" name="zip" placeholder="10001" required>
				<label for="city"><i class="fa fa-institution"></i> City</label>
				<input type="text" id="city" name="city" placeholder="New York">

				<div class="rows">
				<div class="col-50">
					<label for="state">State</label>
					<input type="text" id="state" name="state" placeholder="NY" required>
				</div>
				<div class="col-50">

				</div>
				</div>	
	

				<div class="col-50">

				
					<label for="ccnum">Contact No</label>
					<input type="text" id="ccnum" name="cardnumber" placeholder="1111-2222-3333-4444" required>
			  </div>
			</div>	  


		</div>
	</div>
					

<div class="rows" id="billing">
  <div class="col-">
    <div class="containers">
      <form id='form'>

        <div class="rows">
          <div class="col-lg-8 col-12">
			<h3>Delivery Address</h3>
			
			<div id = 'user-info'>
				
				<label for="adr"><i class="fa fa-address-card-o"></i> Address</label>
				<input type="text" id="adr" name="address" placeholder="542 W. 15th Street">
				
				<label for="city"><i class="fa fa-institution"></i> City</label>
				<input type="text" id="city" name="city" placeholder="New York">

				<div class="rows">
				<div class="col-50">
					<label for="state">Zone</label>
					<input type="text" id="zone" name="state" placeholder="NY" required>
				</div>
				<div class="col-50">
					<label for="zip">Postal Code</label>
					<input type="text" id="postal_code" name="zip" placeholder="10001" required>
				</div>
				</div>	
	

				
			</div>	  

        </div>
        <label>
          <input type="checkbox" checked="checked" name="sameadr"> Shipping address same as billing
        </label>
        <input type="submit" value="Continue" class="btns" id="form-button" >
      </form>
    </div>
  </div>


</div>

		</section>
		<!--/ End Checkout -->
		
		<!-- Start Shop Services Area  -->
		<section class="shop-services section home">
			<div class="container">
				<div class="row">
					<div class="col-lg-3 col-md-6 col-12">
						<!-- Start Single Service -->
						<div class="single-service">
							<i class="ti-rocket"></i>
							<h4>Free shiping</h4>
							<p>Orders over $100</p>
						</div>
						<!-- End Single Service -->
					</div>
					<div class="col-lg-3 col-md-6 col-12">
						<!-- Start Single Service -->
						<div class="single-service">
							<i class="ti-reload"></i>
							<h4>Free Return</h4>
							<p>Within 30 days returns</p>
						</div>
						<!-- End Single Service -->
					</div>
					<div class="col-lg-3 col-md-6 col-12">
						<!-- Start Single Service -->
						<div class="single-service">
							<i class="ti-lock"></i>
							<h4>Sucure Payment</h4>
							<p>100% secure payment</p>
						</div>
						<!-- End Single Service -->
					</div>
					<div class="col-lg-3 col-md-6 col-12">
						<!-- Start Single Service -->
						<div class="single-service">
							<i class="ti-tag"></i>
							<h4>Best Price</h4>
							<p>Guaranteed price</p>
						</div>
						<!-- End Single Service -->
					</div>
				</div>
			</div>
		</section>
		<!-- End Shop Services -->


		<script type="text/javascript">
			var shipping = '{{order.shipping}}'
			var total = '{{order.get_cart_grandtotal|floatformat:2}}'
			console.log(shipping)
			if(shipping == 'True'){
				document.getElementById('checkout').innerHTML = ''
				console.log("if")

			}
			else{
				console.log('else')
				document.getElementById('delivery-charge').innerHTML = ''
				document.getElementById('user-info').innerHTML = ''
				
			}




			var form = document.getElementById('form')
			
			document.getElementById('form-button').addEventListener('click',function(e){
				submitFormData();
				
			})

			function submitFormData(){
				console.log('payment button clicked')
				
				var userFormData = {

					'total' : total,
				}

				var shippingInfo = {
					
					
					'address' :  null,
					'address1' : null,
					'city' :  null,
					'zone' :  null,
					'postal_code' :  null,

			}
			
			
			if (shipping != 'False'){
				shippingInfo.address = form.address.value
				shippingInfo.city = form.city.value
				shippingInfo.zone = form.state.value
				shippingInfo.postal_code = form.zip.value
			}



			var url = '/process_order/'
			fetch(url, {
				method:'POST',
				headers:{
					'Content-Type':'application/json',
					'X-CSRFToken' : csrftoken,
				},
				body:JSON.stringify({'form':userFormData, 'shipping':shippingInfo}),
			})
			.then((response) => response.json())
    		.then((data) =>{
        		console.log('Success:', data);
        		alert('Transaction Completed');

        		window.location.href ="{% url 'Store:homepage' %}"
    		})
		}
	</script>

	{% endblock %}
